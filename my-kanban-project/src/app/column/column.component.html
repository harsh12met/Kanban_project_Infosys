<!-- Kanban Column -->
<div
  [class]="getColumnClass()"
  (dragstart)="onColumnDragStart($event)"
  (dragover)="onColumnDragOver($event)"
  (dragleave)="onColumnDragLeave($event)"
  (drop)="onColumnDrop($event)"
>
  <!-- Column Header -->
  <div class="column-header">
    <!-- View Mode -->
    <div *ngIf="!isEditingTitle" class="column-title-container">
      <h3 class="column-title">{{ title }}</h3>
      <button
        class="edit-title-btn"
        (click)="startEditTitle()"
        title="Edit column name"
      >
        âœï¸
      </button>
    </div>
    
    <!-- Edit Mode -->
    <div *ngIf="isEditingTitle" class="column-title-edit">
      <input
        type="text"
        [(ngModel)]="editTitleValue"
        (keyup.enter)="saveTitle()"
        (keyup.escape)="cancelEditTitle()"
        class="edit-title-input"
        #titleInput
      />
      <button class="save-title-btn" (click)="saveTitle()" title="Save">âœ“</button>
      <button class="cancel-title-btn" (click)="cancelEditTitle()" title="Cancel">âœ•</button>
    </div>
    
    <div class="column-actions">
      <span class="task-count">{{ tasks.length }}</span>
      <button
        class="add-column-btn"
        (click)="requestAddColumn()"
        title="Add new column"
      >
        +
      </button>
      <button
        *ngIf="!isDefaultColumn()"
        class="remove-column-btn"
        (click)="requestRemoveColumn()"
        title="Remove this column"
      >
        Ã—
      </button>
    </div>
  </div>

  <!-- Add Task Component (shown for all columns) -->
  <div class="add-task-container">
    <app-add-task [columnStatus]="columnId" (taskAdded)="onTaskAdded()">
    </app-add-task>
  </div>

  <!-- Tasks Container - Scrollable -->
  <div class="tasks-container"
       (dragover)="onTaskDragOver($event)"
       (dragleave)="onTaskDragLeave($event)"
       (drop)="onTaskDrop($event)">
    <!-- Drop zone at the top -->
    <div
      class="drop-zone"
      [class.active-drop-zone]="dragOverIndex === 0"
      (dragover)="onDragOverAtIndex($event, 0)"
      (drop)="onDropAtIndex($event, 0)"
    ></div>

    <!-- Individual Tasks with drop zones -->
    <ng-container
      *ngFor="let task of tasks; let i = index; trackBy: trackTaskById"
    >
      <!-- The actual task -->
      <app-task
        [task]="task"
        (taskUpdated)="onTaskUpdated()"
        (taskDeleted)="onTaskDeleted()"
      >
      </app-task>

      <!-- Drop zone after each task -->
      <div
        class="drop-zone"
        [class.active-drop-zone]="dragOverIndex === i + 1"
        (dragover)="onDragOverAtIndex($event, i + 1)"
        (drop)="onDropAtIndex($event, i + 1)"
      ></div>
    </ng-container>

    <!-- Empty State -->
    <div *ngIf="tasks.length === 0" class="empty-state">
      <div class="empty-icon">ğŸ“‹</div>
      <p class="empty-message">
        {{
          columnId === "todo"
            ? "Click + to add new tasks"
            : columnId === "inprogress"
            ? "Drag tasks here from Todo"
            : "Drag completed tasks here"
        }}
      </p>
    </div>
  </div>

  <!-- Drop Zone Indicator -->
  <div *ngIf="isDragOver" class="drop-indicator">
    <span class="drop-text">Drop task here</span>
  </div>
</div>
